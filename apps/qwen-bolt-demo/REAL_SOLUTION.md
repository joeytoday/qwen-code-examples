# 真实可行的解决方案

## 问题根源

@qwen-code/SDK 在执行时会使用自己的工作目录（通常在 `~/.qwen/sessions/` 或类似位置），而不是我们在代码中指定的目录。这导致：

1. 文件被创建在 SDK 的工作目录
2. 我们的 API 在错误的位置查找文件
3. 前端无法加载文件

## 解决方案

### 选项 1：直接使用 SDK 的工作目录（最简单）

修改 `/api/files` 和 `/api/preview` API，直接从 SDK 的实际工作目录读取文件。

**步骤：**

1. 从 SDK 获取实际的工作目录路径
2. 修改文件 API 使用该路径
3. 前端保持不变

### 选项 2：让 SDK 使用我们指定的目录

通过 SDK 配置强制使用我们创建的目录。

**步骤：**

1. 在 SDK 初始化时指定工作目录
2. 确保 SDK 在该目录创建文件
3. API 从该目录读取

### 选项 3：实时监听文件变化（最可靠）

使用文件系统监听器实时跟踪 SDK 创建的文件。

**步骤：**

1. 监听 SDK 的工作目录
2. 文件创建时通知前端
3. 前端实时更新

## 推荐实现

我建议使用**选项 1**，因为：
- 最简单直接
- 不需要修改 SDK 行为
- 可以立即工作

## 关于终端功能

要添加完整的终端功能，需要：

1. **后端 WebSocket 服务器**
   ```typescript
   // 需要创建 /api/socket 路由
   // 使用 socket.io 处理终端连接
   ```

2. **前端终端组件**
   ```typescript
   // 使用 @xterm/xterm
   // 连接到 WebSocket
   ```

3. **进程管理**
   ```typescript
   // 使用 node-pty 创建伪终端
   // 执行 shell 命令
   ```

但这需要大量额外工作，不是简单的集成。

## 当前状态

- ✅ CodeRenderer 组件已创建
- ✅ 基础 UI 布局完成
- ❌ 文件加载功能需要修复
- ❌ 终端功能未实现
- ❌ 完整的沙箱环境未实现

## 建议

1. **短期**：修复文件加载，让基本功能工作
2. **中期**：添加简单的日志查看
3. **长期**：考虑是否真的需要完整的沙箱环境

如果你的主要目标是"AI 生成代码并预览"，那么当前的实现（修复文件加载后）已经足够。

如果你需要完整的沙箱环境（终端、容器、隔离执行），那需要重新设计架构，可能需要：
- Docker 容器
- WebSocket 服务器
- 进程管理
- 安全隔离

这是一个更大的项目，不是简单的"集成"。
